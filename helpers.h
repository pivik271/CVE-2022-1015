#pragma once
#include <stdint.h>
#include <linux/netfilter.h>

#include <libnftnl/table.h>
#include <libnftnl/chain.h>
#include <libnftnl/rule.h>

#define NFTA_BITWISE_OP 6
#define NFTA_BITWISE_DATA 7

void set_register_to_value(struct nftnl_rule* r, uint32_t dreg, void* data, size_t data_len);
void set_verdict(struct nftnl_rule* r, uint32_t verdict);

void add_bitwise(struct nftnl_rule *r, uint32_t shift_type, uint32_t expr_len, uint32_t expr_sreg, uint32_t expr_dreg, void* data, uint32_t data_len);
void add_cmp(struct nftnl_rule *r, uint32_t sreg, uint32_t op, const void *data, uint32_t data_len);

void add_payload(struct nftnl_rule *r, uint32_t base, uint32_t dreg, uint32_t offset, uint32_t len);
void add_payload_set(struct nftnl_rule *r, uint32_t base, uint32_t sreg, uint32_t offset, uint32_t len);

struct nftnl_table *table_add_parse(char *table_name);
struct nftnl_chain *chain_add_parse(char *table_name, char *chain_name, int hooknum);

void add_table(char *table_name);
void add_chain(char *table_name, char *chain_name, int hooknum);
void add_leak_rule(char *table, char *chain);
void add_rop_rule(char *table, char *chain);

struct nftnl_table *table_del_parse(char *table_name);
void del_table(char *table_name);